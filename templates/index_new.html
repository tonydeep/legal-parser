<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnamese Legal Parser - Knowledge Graph Generator</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 10px;
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .features {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .feature-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: #e0e5ec;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #d0d5dc;
        }

        .tab-btn.active {
            background: white;
            font-weight: 600;
            color: #667eea;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 0 8px 8px 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .tab-content.active {
            display: block;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        textarea, input[type="text"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e5ec;
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 200px;
            resize: vertical;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e5ec;
            color: #555;
        }

        .btn-secondary:hover {
            background: #d0d5dc;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Results */
        .result-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .result-box h3 {
            font-size: 1rem;
            color: #667eea;
            margin-bottom: 10px;
        }

        .result-box pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.85rem;
            max-height: 400px;
        }

        .result-box code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #f0f4ff 0%, #e8f0fe 100%);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-card .label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        /* Info boxes */
        .info-box {
            background: #e0f2fe;
            border-left: 4px solid #0ea5e9;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 20px;
        }

        .info-box.warning {
            background: #fef3c7;
            border-left-color: #f59e0b;
        }

        .info-box.success {
            background: #d1fae5;
            border-left-color: #10b981;
        }

        /* Query list */
        .query-list {
            display: grid;
            gap: 10px;
        }

        .query-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .query-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .query-item h4 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .query-item p {
            font-size: 0.85rem;
            color: #666;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            header h1 {
                font-size: 1.5rem;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-btn {
                border-radius: 8px;
            }
        }

        /* Copy button */
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            font-size: 0.75rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .code-container {
            position: relative;
        }

        /* Download section */
        .download-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèõÔ∏è Vietnamese Legal Parser</h1>
            <p>Property Knowledge Graph Generator with LRMoo Ontology</p>
            <div class="features">
                <span class="feature-badge">15 Doc Types</span>
                <span class="feature-badge">7-Tier Hierarchy</span>
                <span class="feature-badge">8 Legislative Actions</span>
                <span class="feature-badge">5 Legal Relationships</span>
                <span class="feature-badge">Neo4j 5.x</span>
            </div>
        </header>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('parse')">üìÑ Parse Document</button>
            <button class="tab-btn" onclick="showTab('urn')">üîó Generate URN</button>
            <button class="tab-btn" onclick="showTab('cypher')">‚öôÔ∏è Generate Cypher</button>
            <button class="tab-btn" onclick="showTab('queries')">üîç Query Templates</button>
            <button class="tab-btn" onclick="showTab('schema')">üìä Schema</button>
        </div>

        <!-- Tab 1: Parse Document -->
        <div id="parse" class="tab-content active">
            <h2>Parse Vietnamese Legal Document</h2>
            <p style="color: #666; margin-bottom: 20px;">Extract structure, metadata, and relationships from legal documents</p>

            <div class="form-group">
                <label for="docText">Document Text</label>
                <textarea id="docText" placeholder="Paste your Vietnamese legal document here...

Example:
NGH·ªä ƒê·ªäNH
V·ªÄ C√îNG T√ÅC VƒÇN TH∆Ø

CƒÉn c·ª© Lu·∫≠t T·ªï ch·ª©c Ch√≠nh ph·ªß ng√†y 19 th√°ng 6 nƒÉm 2015;

Ch√≠nh ph·ªß ban h√†nh Ngh·ªã ƒë·ªãnh v·ªÅ c√¥ng t√°c vƒÉn th∆∞.

Ch∆∞∆°ng I
QUY ƒê·ªäNH CHUNG

ƒêi·ªÅu 1. Ph·∫°m vi ƒëi·ªÅu ch·ªânh
Ngh·ªã ƒë·ªãnh n√†y quy ƒë·ªãnh v·ªÅ c√¥ng t√°c vƒÉn th∆∞."></textarea>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="parseDocument()">
                    üîç Parse Document
                </button>
                <button class="btn btn-secondary" onclick="loadSample()">
                    üìù Load Sample
                </button>
                <button class="btn btn-secondary" onclick="clearAll()">
                    üóëÔ∏è Clear
                </button>
            </div>

            <div class="loading" id="parseLoading">
                <div class="spinner"></div>
                <p>Parsing document...</p>
            </div>

            <div id="parseResults" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="value" id="statDocType">-</div>
                        <div class="label">Document Type</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="statAction">-</div>
                        <div class="label">Legislative Action</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="statComponents">0</div>
                        <div class="label">Components</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="statRefs">0</div>
                        <div class="label">References</div>
                    </div>
                </div>

                <div class="result-box">
                    <h3>üìã Parse Results (JSON)</h3>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('parseJson')">Copy</button>
                        <pre><code id="parseJson"></code></pre>
                    </div>
                </div>

                <div class="download-section">
                    <button class="btn btn-success" onclick="generateCypherFromParse()">
                        ‚öôÔ∏è Generate Cypher Script
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab 2: Generate URN -->
        <div id="urn" class="tab-content">
            <h2>Generate URN Identifiers</h2>
            <p style="color: #666; margin-bottom: 20px;">Create persistent URN identifiers following LexML Vietnam standards</p>

            <div class="info-box">
                <strong>URN Format:</strong> urn:lex:vn:{jurisdiction}:{type}:{date};{number}[@version][!component]
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="urnDocType">Document Type</label>
                    <select id="urnDocType">
                        <option value="HIEN_PHAP">Hi·∫øn ph√°p (Constitution)</option>
                        <option value="BO_LUAT">B·ªô lu·∫≠t (Legal Code)</option>
                        <option value="LUAT">Lu·∫≠t (Law)</option>
                        <option value="NGHI_DINH" selected>Ngh·ªã ƒë·ªãnh (Decree)</option>
                        <option value="THONG_TU">Th√¥ng t∆∞ (Circular)</option>
                        <option value="QUYET_DINH">Quy·∫øt ƒë·ªãnh (Decision)</option>
                        <option value="NGHI_QUYET">Ngh·ªã quy·∫øt (Resolution)</option>
                        <option value="PHAP_LENH">Ph√°p l·ªánh (Ordinance)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="urnAuthority">Issuing Authority</label>
                    <select id="urnAuthority">
                        <option value="QUOC_HOI">Qu·ªëc h·ªôi</option>
                        <option value="UBTVQH">UBTVQH</option>
                        <option value="CHINH_PHU" selected>Ch√≠nh ph·ªß</option>
                        <option value="THU_TUONG">Th·ªß t∆∞·ªõng</option>
                        <option value="BO_TAI_CHINH">B·ªô T√†i ch√≠nh</option>
                        <option value="BO_TU_PHAP">B·ªô T∆∞ ph√°p</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="urnDate">Issue Date</label>
                    <input type="text" id="urnDate" placeholder="YYYY-MM-DD" value="2024-01-15">
                </div>

                <div class="form-group">
                    <label for="urnNumber">Document Number</label>
                    <input type="text" id="urnNumber" placeholder="e.g., 01/2024/Nƒê-CP" value="01/2024/Nƒê-CP">
                </div>
            </div>

            <div class="form-group">
                <label for="urnComponent">Component (Optional)</label>
                <input type="text" id="urnComponent" placeholder="e.g., DIEU:1 or KHOAN:2">
            </div>

            <button class="btn btn-primary" onclick="generateURN()">
                üîó Generate URN
            </button>

            <div id="urnResult" class="result-box" style="display: none;">
                <h3>Generated URNs</h3>
                <pre><code id="urnOutput"></code></pre>
            </div>
        </div>

        <!-- Tab 3: Generate Cypher -->
        <div id="cypher" class="tab-content">
            <h2>Generate Neo4j Cypher Script</h2>
            <p style="color: #666; margin-bottom: 20px;">Convert parsed documents to Neo4j import scripts</p>

            <div class="form-group">
                <label>Generator Type</label>
                <div style="display: flex; gap: 20px; margin-top: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="cypherType" value="basic" checked>
                        <span>Basic (Lightweight)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="cypherType" value="enhanced">
                        <span>Enhanced (Full Ontology)</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="cypherText">Document Text</label>
                <textarea id="cypherText" placeholder="Paste document text here or parse from Tab 1..."></textarea>
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="includeEvents" checked>
                    <span>Include Legislative Events (SuKienLapPhap)</span>
                </label>
            </div>

            <button class="btn btn-primary" onclick="generateCypher()">
                ‚öôÔ∏è Generate Cypher
            </button>

            <div id="cypherResult" class="result-box" style="display: none;">
                <h3>Neo4j Cypher Script</h3>
                <div class="code-container">
                    <button class="copy-btn" onclick="copyCode('cypherOutput')">Copy</button>
                    <pre><code id="cypherOutput"></code></pre>
                </div>
                <div class="download-section">
                    <button class="btn btn-success" onclick="downloadCypher()">
                        üì• Download .cypher File
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab 4: Query Templates -->
        <div id="queries" class="tab-content">
            <h2>Query Templates</h2>
            <p style="color: #666; margin-bottom: 20px;">Production-ready Cypher queries for common use cases</p>

            <div class="query-list">
                <div class="query-item" onclick="showQuery('pit')">
                    <h4>üìÖ Point-in-Time Retrieval</h4>
                    <p>Get article content at a specific date</p>
                </div>
                <div class="query-item" onclick="showQuery('reconstruct')">
                    <h4>üîÑ Document Reconstruction</h4>
                    <p>Rebuild complete document structure at a date</p>
                </div>
                <div class="query-item" onclick="showQuery('history')">
                    <h4>üìú Version History</h4>
                    <p>Track all changes to a component over time</p>
                </div>
                <div class="query-item" onclick="showQuery('changes')">
                    <h4>üìä Changes in Period</h4>
                    <p>Find all amendments within a date range</p>
                </div>
                <div class="query-item" onclick="showQuery('implementing')">
                    <h4>üîó Implementing Documents</h4>
                    <p>Find decrees/circulars that implement a law</p>
                </div>
                <div class="query-item" onclick="showQuery('basis')">
                    <h4>‚öñÔ∏è Legal Basis Chain</h4>
                    <p>Trace the legal authority hierarchy</p>
                </div>
                <div class="query-item" onclick="showQuery('impact')">
                    <h4>üí• Cross-Document Impact</h4>
                    <p>Find documents affected by an amendment</p>
                </div>
                <div class="query-item" onclick="showQuery('search')">
                    <h4>üîç Full-Text Search</h4>
                    <p>Search content across all documents</p>
                </div>
            </div>

            <div id="queryResult" class="result-box" style="display: none;">
                <h3 id="queryTitle">Query</h3>
                <div class="code-container">
                    <button class="copy-btn" onclick="copyCode('queryOutput')">Copy</button>
                    <pre><code id="queryOutput"></code></pre>
                </div>
            </div>
        </div>

        <!-- Tab 5: Schema -->
        <div id="schema" class="tab-content">
            <h2>Neo4j Schema Overview</h2>
            <p style="color: #666; margin-bottom: 20px;">Graph structure and initialization script</p>

            <div class="info-box success">
                <strong>How to Use:</strong> Run the schema initialization script in Neo4j before importing documents.
            </div>

            <h3 style="margin: 20px 0 15px;">Node Types</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="value">üìÑ</div>
                    <div class="label">VanBan (Document)</div>
                </div>
                <div class="stat-card">
                    <div class="value">üìë</div>
                    <div class="label">ThanhPhanVanBan</div>
                </div>
                <div class="stat-card">
                    <div class="value">‚è±Ô∏è</div>
                    <div class="label">PhienBanVanBan</div>
                </div>
                <div class="stat-card">
                    <div class="value">üìù</div>
                    <div class="label">CTV</div>
                </div>
                <div class="stat-card">
                    <div class="value">üèõÔ∏è</div>
                    <div class="label">CoQuanBanHanh</div>
                </div>
                <div class="stat-card">
                    <div class="value">üéØ</div>
                    <div class="label">SuKienLapPhap</div>
                </div>
            </div>

            <h3 style="margin: 20px 0 15px;">Key Relationships</h3>
            <div class="result-box">
                <pre><code>HAS_COMPONENT    ‚Üí Hierarchical structure
HAS_EXPRESSION   ‚Üí Work to Expression (versioning)
AGGREGATES       ‚Üí Temporal aggregation pattern
ISSUED_BY        ‚Üí Authority relationship
CAN_CU           ‚Üí Legal basis
HUONG_DAN_THI_HANH ‚Üí Implementation guidance
QUY_DINH_CHI_TIET  ‚Üí Detailed regulation
KE_THUA          ‚Üí Inheritance
THAM_CHIEU       ‚Üí Reference</code></pre>
            </div>

            <div class="download-section">
                <button class="btn btn-primary" onclick="downloadSchema()">
                    üì• Download schema_init.cypher
                </button>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // Parse Document
        async function parseDocument() {
            const text = document.getElementById('docText').value;
            if (!text.trim()) {
                alert('Please enter document text');
                return;
            }

            document.getElementById('parseLoading').classList.add('active');
            document.getElementById('parseResults').style.display = 'none';

            try {
                const response = await fetch('/api/parse', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text })
                });

                const data = await response.json();

                if (data.success) {
                    const summary = data.summary;

                    // Update stats
                    document.getElementById('statDocType').textContent =
                        summary.metadata?.loai_van_ban || '-';
                    document.getElementById('statAction').textContent =
                        summary.metadata?.hanh_dong_lap_phap || 'BAN_HANH';
                    document.getElementById('statComponents').textContent =
                        summary.structure_summary?.total_components || 0;
                    document.getElementById('statRefs').textContent =
                        summary.cross_references_count || 0;

                    // Show JSON
                    document.getElementById('parseJson').textContent =
                        JSON.stringify(summary, null, 2);

                    document.getElementById('parseResults').style.display = 'block';

                    // Copy text to Cypher tab
                    document.getElementById('cypherText').value = text;
                } else {
                    alert('Parse error: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                document.getElementById('parseLoading').classList.remove('active');
            }
        }

        // Load sample document
        function loadSample() {
            document.getElementById('docText').value = `NGH·ªä ƒê·ªäNH
V·ªÄ C√îNG T√ÅC VƒÇN TH∆Ø

CƒÉn c·ª© Lu·∫≠t T·ªï ch·ª©c Ch√≠nh ph·ªß ng√†y 19 th√°ng 6 nƒÉm 2015;
CƒÉn c·ª© Lu·∫≠t Ban h√†nh vƒÉn b·∫£n quy ph·∫°m ph√°p lu·∫≠t ng√†y 22 th√°ng 6 nƒÉm 2015;

Theo ƒë·ªÅ ngh·ªã c·ªßa B·ªô tr∆∞·ªüng B·ªô N·ªôi v·ª•;

Ch√≠nh ph·ªß ban h√†nh Ngh·ªã ƒë·ªãnh v·ªÅ c√¥ng t√°c vƒÉn th∆∞.

Ch∆∞∆°ng I
QUY ƒê·ªäNH CHUNG

ƒêi·ªÅu 1. Ph·∫°m vi ƒëi·ªÅu ch·ªânh

Ngh·ªã ƒë·ªãnh n√†y quy ƒë·ªãnh v·ªÅ c√¥ng t√°c vƒÉn th∆∞ v√† h∆∞·ªõng d·∫´n thi h√†nh Lu·∫≠t Ban h√†nh vƒÉn b·∫£n quy ph·∫°m ph√°p lu·∫≠t.

1. So·∫°n th·∫£o, ban h√†nh vƒÉn b·∫£n.

2. Qu·∫£n l√Ω vƒÉn b·∫£n.

a) ƒêƒÉng k√Ω vƒÉn b·∫£n ƒëi, ƒë·∫øn.

b) L∆∞u tr·ªØ vƒÉn b·∫£n.

ƒêi·ªÅu 2. ƒê·ªëi t∆∞·ª£ng √°p d·ª•ng

1. C∆° quan h√†nh ch√≠nh nh√† n∆∞·ªõc c√°c c·∫•p.

2. ƒê∆°n v·ªã s·ª± nghi·ªáp c√¥ng l·∫≠p.

ƒêi·ªÅu 3. Gi·∫£i th√≠ch t·ª´ ng·ªØ

1. "VƒÉn b·∫£n" l√† th√¥ng tin th√†nh vƒÉn ƒë∆∞·ª£c h√¨nh th√†nh trong ho·∫°t ƒë·ªông c·ªßa c∆° quan, t·ªï ch·ª©c.

2. "C√¥ng t√°c vƒÉn th∆∞" l√† ho·∫°t ƒë·ªông so·∫°n th·∫£o, ban h√†nh v√† qu·∫£n l√Ω vƒÉn b·∫£n.`;
        }

        // Clear all
        function clearAll() {
            document.getElementById('docText').value = '';
            document.getElementById('parseResults').style.display = 'none';
        }

        // Generate URN
        async function generateURN() {
            const docType = document.getElementById('urnDocType').value;
            const authority = document.getElementById('urnAuthority').value;
            const date = document.getElementById('urnDate').value;
            const number = document.getElementById('urnNumber').value;
            const component = document.getElementById('urnComponent').value;

            try {
                const response = await fetch('/api/generate-urn', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ docType, authority, date, number, component })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('urnOutput').textContent =
                        `Document URN:\n${data.document_urn}\n\nWork ID:\n${data.work_id}` +
                        (data.component_urn ? `\n\nComponent URN:\n${data.component_urn}` : '');
                    document.getElementById('urnResult').style.display = 'block';
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Generate Cypher
        async function generateCypher() {
            const text = document.getElementById('cypherText').value;
            if (!text.trim()) {
                alert('Please enter document text');
                return;
            }

            const cypherType = document.querySelector('input[name="cypherType"]:checked').value;
            const includeEvents = document.getElementById('includeEvents').checked;

            try {
                const response = await fetch('/api/generate-cypher', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, type: cypherType, includeEvents })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('cypherOutput').textContent = data.cypher;
                    document.getElementById('cypherResult').style.display = 'block';
                    window.currentCypher = data.cypher;
                    window.currentFilename = data.filename;
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Download Cypher
        function downloadCypher() {
            if (!window.currentCypher) {
                alert('Please generate Cypher first');
                return;
            }

            const blob = new Blob([window.currentCypher], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = window.currentFilename || 'import.cypher';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Generate Cypher from parse results
        function generateCypherFromParse() {
            const text = document.getElementById('docText').value;
            document.getElementById('cypherText').value = text;
            showTab('cypher');
            document.querySelectorAll('.tab-btn')[2].classList.add('active');
        }

        // Query templates
        const queries = {
            pit: {
                title: 'Point-in-Time Article Retrieval',
                query: `// Get ƒêi·ªÅu 6 Hi·∫øn ph√°p at specific date
MATCH (dieu:Dieu {soDinhDanh: "6"})
  <-[:HAS_COMPONENT]-(vb:VanBan {workId: "HIENPHAP-2013"})
MATCH (dieu)-[:HAS_EXPRESSION]->(ctv:CTV)
WHERE ctv.ngayHieuLuc <= date('2020-01-01')
  AND ctv.ngayHetHieuLuc >= date('2020-01-01')
  AND ctv.trangThai = 'HIEU_LUC'
RETURN dieu.tieuDe, ctv.noiDung, ctv.ngayHieuLuc
ORDER BY ctv.ngayHieuLuc DESC LIMIT 1;`
            },
            reconstruct: {
                title: 'Document Reconstruction',
                query: `// Reconstruct document at date
WITH date('2022-06-15') as targetDate
MATCH (vb:VanBan {workId: "HIENPHAP-2013"})
MATCH (vb)-[:HAS_EXPRESSION]->(tv:PhienBanVanBan)
WHERE tv.ngayHieuLuc <= targetDate
  AND tv.ngayHetHieuLuc >= targetDate
MATCH (tv)-[:AGGREGATES]->(ctv:CTV)
MATCH (ctv)<-[:HAS_EXPRESSION]-(tp:ThanhPhanVanBan)
RETURN tp.loaiThanhPhan, tp.soDinhDanh,
       tp.tieuDe, ctv.noiDung
ORDER BY tp.capBac, tp.thuTuSapXep;`
            },
            history: {
                title: 'Version History',
                query: `// Get version history of a component
MATCH (dieu:Dieu {soDinhDanh: "3"})
  <-[:HAS_COMPONENT]-(vb:VanBan {workId: "BO-LUAT-DAN-SU-2015"})
MATCH (dieu)-[:HAS_EXPRESSION]->(ctv:CTV)
OPTIONAL MATCH (ctv)-[:PRODUCED_BY]->(evt:SuKienLapPhap)
RETURN ctv.ngayHieuLuc, ctv.noiDung,
       ctv.loaiThayDoi, evt.loaiSuKien
ORDER BY ctv.ngayHieuLuc;`
            },
            changes: {
                title: 'Changes in Period',
                query: `// Find changes to document within period
WITH date('2020-01-01') as startDate,
     date('2023-12-31') as endDate
MATCH (vb:VanBan {workId: "LUAT-DOANH-NGHIEP-2020"})
MATCH (vb)-[:HAS_COMPONENT*1..7]->(tp:ThanhPhanVanBan)
MATCH (tp)-[:HAS_EXPRESSION]->(ctv:CTV)
WHERE ctv.ngayHieuLuc >= startDate
  AND ctv.ngayHieuLuc <= endDate
  AND ctv.loaiThayDoi IS NOT NULL
RETURN tp.soDinhDanh, ctv.ngayHieuLuc,
       ctv.loaiThayDoi
ORDER BY ctv.ngayHieuLuc;`
            },
            implementing: {
                title: 'Implementing Documents',
                query: `// Find all implementing documents for a law
MATCH (luat:VanBan {workId: "LUAT-DAU-TU-2020"})
MATCH (vb)-[r:HUONG_DAN_THI_HANH|QUY_DINH_CHI_TIET]->(luat)
RETURN vb.tenGoi, vb.soHieu, vb.loaiVanBan,
       vb.ngayBanHanh, type(r) as relationship
ORDER BY vb.ngayBanHanh DESC;`
            },
            basis: {
                title: 'Legal Basis Chain',
                query: `// Trace legal basis hierarchy
MATCH path = (vb:VanBan {workId: "NGHI-DINH-01-2021"})
  -[:CAN_CU*1..5]->(basis:VanBan)
RETURN basis.tenGoi, basis.soHieu,
       basis.loaiVanBan, basis.capPhapLy
ORDER BY basis.capPhapLy;`
            },
            impact: {
                title: 'Cross-Document Impact',
                query: `// Find documents affected by amendment
MATCH (nd:VanBan {soHieu: "01/2021/Nƒê-CP"})
MATCH (nd)-[r:QUY_DINH_CHI_TIET|HUONG_DAN_THI_HANH|SUA_DOI]
      ->(affected:VanBan)
RETURN affected.tenGoi, affected.soHieu,
       type(r) as relationship
ORDER BY affected.capPhapLy;`
            },
            search: {
                title: 'Full-Text Search',
                query: `// Search across legal content
CALL db.index.fulltext.queryNodes(
  'noi_dung_van_ban',
  'c√¥ng t√°c vƒÉn th∆∞'
)
YIELD node, score
WHERE node:VanBan
RETURN node.tenGoi, node.soHieu, score
ORDER BY score DESC
LIMIT 20;`
            }
        };

        function showQuery(queryId) {
            const q = queries[queryId];
            document.getElementById('queryTitle').textContent = q.title;
            document.getElementById('queryOutput').textContent = q.query;
            document.getElementById('queryResult').style.display = 'block';
        }

        // Copy code
        function copyCode(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            });
        }

        // Download schema
        function downloadSchema() {
            window.location.href = '/api/download-schema';
        }
    </script>
</body>
</html>
